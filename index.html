<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TANMINH DEV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            text-align: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            background: linear-gradient(90deg, #00feba, #5b548a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px #00feba;
        }

        textarea, button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            margin-top: 10px;
            text-align: center;
        }

        textarea {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            resize: none;
        }

        button {
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: linear-gradient(135deg, #0072ff, #00c6ff);
            transform: scale(1.05);
        }

        #loading {
            margin-top: 10px;
            font-weight: bold;
            font-size: 18px;
            color: #ffeb3b;
            display: none;
        }

        #result {
            margin-top: 10px;
            font-size: 18px;
        }

        #historyToggle {
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TANMINH DEV</h1>
        <textarea id="inputNumbers" placeholder="Nhập dãy số, ít nhất 20 số..."></textarea>
        <button id="analyzeButton">Cập Nhật & Phân Tích</button>
        <div id="loading">Đang phân tích...</div>
        <div id="result" class="hidden"></div>
        <div id="historyToggle">Lịch Sử ▼</div>
        <div id="history" class="hidden"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const inputNumbers = document.getElementById("inputNumbers");
            const analyzeButton = document.getElementById("analyzeButton");
            const loading = document.getElementById("loading");
            const result = document.getElementById("result");
            const historyToggle = document.getElementById("historyToggle");
            const history = document.getElementById("history");

            let historyData = [];

            inputNumbers.addEventListener("input", () => {
                let numbers = inputNumbers.value.replace(/\D+/g, '').split('').join(',');
                inputNumbers.value = numbers;
            });

            analyzeButton.addEventListener("click", () => {
                let numbers = inputNumbers.value.match(/\d+/g);
                if (!numbers || numbers.length < 20) {
                    alert("Vui lòng nhập ít nhất 20 số.");
                    return;
                }

                loading.style.display = "block";
                result.classList.add("hidden");

                setTimeout(() => {
                    let prediction = analyzeNumbers(numbers);
                    historyData.push(prediction);
                    updateHistory();
                    loading.style.display = "none";
                    result.classList.remove("hidden");
                    result.innerHTML = `<b>Kết Quả:</b> ${prediction.result} (${prediction.confidence}%)`;
                }, Math.random() * 5000 + 5000);
            });

            historyToggle.addEventListener("click", () => {
                history.classList.toggle("hidden");
            });

            function analyzeNumbers(numbers) {
                let total = numbers.length;
                let largeCount = numbers.filter(n => n >= 5).length;
                let smallCount = total - largeCount;

                let confidenceLarge = calculateConfidence(numbers, "Lớn");
                let confidenceSmall = calculateConfidence(numbers, "Nhỏ");

                let result, confidence;
                if (Math.abs(confidenceLarge - confidenceSmall) < 10) {
                    result = Math.random() > 0.5 ? "Lớn" : "Nhỏ";
                    confidence = Math.max(confidenceLarge, confidenceSmall);
                } else {
                    result = confidenceLarge > confidenceSmall ? "Lớn" : "Nhỏ";
                    confidence = Math.max(confidenceLarge, confidenceSmall);
                }

                return { result, confidence };
            }

            function calculateConfidence(numbers, type) {
                let lastNumbers = numbers.slice(-10);
                let lastResults = lastNumbers.map(n => (n >= 5 ? "Lớn" : "Nhỏ"));
                let matchCount = lastResults.filter(r => r === type).length;

                let patternWeight = detectPattern(numbers, type);
                let statisticalConfidence = calculateStatisticalProbability(numbers, type);
                let trendCorrection = detectReverseTrend(numbers, type);

                let confidence = Math.round(((matchCount / 10) * 30) + patternWeight + statisticalConfidence + trendCorrection);
                
                return Math.min(Math.max(confidence, 50), 85);
            }

            function calculateStatisticalProbability(numbers, type) {
                let totalCount = numbers.length;
                let typeCount = numbers.filter(n => (n >= 5 ? "Lớn" : "Nhỏ") === type).length;
                return (typeCount / totalCount) * 30;
            }

            function detectPattern(numbers, type) {
                let lastFive = numbers.slice(-5);
                let matches = lastFive.filter(n => (type === "Lớn" ? n >= 5 : n < 5)).length;
                return matches * 6;
            }

            function detectReverseTrend(numbers, type) {
                let lastSix = numbers.slice(-6);
                let trend = lastSix.map(n => (n >= 5 ? "Lớn" : "Nhỏ"));
                let count = trend.filter(r => r === type).length;

                if (count === 6) return -15;
                if (count === 5) return -10;
                return 0;
            }

            function updateHistory() {
                history.innerHTML = historyData.map(h => `<p>${h.result} (${h.confidence}%)</p>`).join("");
            }
        });
    </script>
</body>
</html>
